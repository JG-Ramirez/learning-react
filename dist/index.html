<html>

<head>
    <title>bullet journal</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="manifest" href="/manifest.json">
</head>

<body>
    <div id="container"></div>
    <script>
        if ('serviceWorker' in navigator) {

            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js').then(function (ServiceWorkerRegistration) {
                    // Registration was successful
                    console.log('ServiceWorker registration successful with scope: ', ServiceWorkerRegistration.scope);
                    const subscribeOptions = {
                        userVisibleOnly: true,
                        applicationServerKey: urlBase64ToUint8Array('BNVFaEer_S5bnKoFlwJjf5wzW7EUCIWzYtu6wVw_mnwWVCukMNdwyC1grHaQSfVEeDIFohbgw47tncBHaNa9AZE')
                    };
                    return registration.pushManager.subscribe(subscribeOptions);
                }).then(function (pushSubscription) {
                    console.log(`this is the endpoint of this user ${PushSubscription.endpoint}`)
                    return fetch(`/api/save-subscription`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(subscription)
                    })
                }).catch(function (err) {
                    // registration failed :(
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
    <script src="/bundle.js">

    </script>
</body>

</html>